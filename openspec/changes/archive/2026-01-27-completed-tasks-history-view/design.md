## Context

現在のアプリはシングルページ構成で、`App.tsx` が直接 `TaskTreeView` を表示している。ルーターは導入されておらず、ナビゲーションはダイアログ/ドロワーで実現している。タスクモデルには `completedAt`（ISO 8601 文字列）フィールドが既に存在し、ステータスを `completed` に変更した時点で自動設定される。

## Goals / Non-Goals

**Goals:**
- 完了タスクを完了日ごとにグループ化して表示する履歴ビューを追加する
- 既存の一覧ビューと同じツリー形式で表示する
- その日に完了したタスクを緑色でハイライトする
- 一覧ビューと履歴ビューを切り替えられるようにする

**Non-Goals:**
- 完了→未完了への戻し操作に対する高度な整合性管理（シンプルに保つ）
- React Router などのルーティングライブラリ導入
- 完了日の手動編集機能

## Decisions

### 1. ビュー切り替え方式：タブ UI（ルーター不使用）

現在のシングルページ構成を維持し、`App.tsx` レベルでタブ（またはトグル）によるビュー切り替えを実装する。

**理由**: ルーターを導入する必要がなく、最小限の変更で実現できる。アプリ規模がまだ小さく、ルーティングの恩恵が限定的。

**代替案**: React Router 導入 → アプリ規模に対してオーバーキル。

### 2. 日付グループ化方式：表示時に `completedAt` から算出

ストアに新たなフィールドは追加せず、表示時に `completedAt` の日付部分（YYYY-MM-DD）でグループ化する。セレクタ（derived state）として実装する。

**理由**: データモデルに変更が不要で、`completedAt` は既に自動設定されている。実装が最もシンプル。

### 3. ツリー表示の再利用

履歴ビューでは、日付ごとに完了タスクとその祖先タスクを含むツリーを構築する。既存の `TaskTreeNode` / `TaskTreeItem` コンポーネントをそのまま再利用し、完了タスクかどうかを示す props で緑色ハイライトを制御する。

**理由**: UI の一貫性を保ちつつ、コードの重複を最小化できる。

### 4. 祖先タスクの表示

完了タスクの親タスクチェーンをツリーに含めることで、タスクの文脈を保つ。ただし、緑色ハイライトはその日に完了したタスクのみに適用する。

**理由**: ツリー構造で表示するにはルートからのパスが必要。親なしでフラットに表示すると階層の文脈が失われる。

### 5. 日付の降順表示

履歴ビューでは最新の完了日を先頭に、降順で日付セクションを並べる。

**理由**: 直近の作業実績を確認するユースケースが最も多いと想定される。

## Risks / Trade-offs

- **タスク数が多い場合のパフォーマンス**: 全タスクを走査してグループ化するため、タスク数が数千を超えると遅延の可能性がある → 現段階ではシングルユーザー用途なので許容。必要に応じてメモ化で対応可能。
- **完了→未完了の戻し**: `completedAt` が削除されるため、履歴ビューから自動的に消える。特別な対応は行わない（proposal の方針通り）。
- **タイムゾーン**: `completedAt` は ISO 8601 で保存されている。日付グループ化はブラウザのローカルタイムゾーンで行う → ユーザーがタイムゾーンを跨いで使用する場合にグルーピングが変わる可能性があるが、シングルユーザー用途では問題にならない。
