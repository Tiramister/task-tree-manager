## Context

Phase 1 で Vite + React + TypeScript + Tailwind + Shadcn/ui の基盤が構築済み。現在は静的な UI のみで、データを扱う仕組みがない。シングルユーザー想定のブラウザ完結型アプリケーションとして、軽量な状態管理とローカルストレージによる永続化を実装する。

## Goals / Non-Goals

**Goals:**
- タスクの木構造を表現できる型定義
- CRUD 操作を提供するタスクストア
- ブラウザを閉じてもデータが保持される永続化

**Non-Goals:**
- サーバーサイドとの同期
- 複数デバイス間のデータ共有
- IndexedDB への対応（将来的な拡張として検討）
- undo/redo 機能

## Decisions

### 1. タスクの木構造表現: 隣接リスト方式

**選択:** 各タスクが `parentId` を持つフラットな配列

**理由:**
- localStorage との相性が良い（JSON シリアライズが容易）
- CRUD 操作がシンプル
- 深いネストでもパフォーマンス劣化しにくい

**代替案:**
- ネスト構造（children 配列を持つ）: 表示時に便利だが、更新時に親を探索する必要がありシリアライズも複雑

### 2. 状態管理: Zustand

**選択:** Zustand

**理由:**
- future-spec.md で選定済み
- ボイラープレートが少なくシンプル
- persist ミドルウェアで localStorage 連携が容易

**代替案:**
- Redux Toolkit: 機能豊富だが、シングルユーザーアプリには過剰
- React Context: 再レンダリング最適化が難しい

### 3. 永続化: Zustand persist ミドルウェア

**選択:** Zustand の `persist` ミドルウェアを使用

**理由:**
- ストア定義と永続化を一箇所で管理できる
- 自動的に保存・復元される
- バージョン管理（migration）機能あり

**代替案:**
- 手動で useEffect で同期: ボイラープレートが増える、タイミング制御が複雑

### 4. ID 生成: crypto.randomUUID()

**選択:** ブラウザ標準の `crypto.randomUUID()`

**理由:**
- 外部依存なし
- 十分なユニーク性
- モダンブラウザで広くサポート

**代替案:**
- uuid パッケージ: 追加依存が必要
- Date.now() ベース: 衝突の可能性あり

## Risks / Trade-offs

**[localStorage の容量制限（約5MB）]**
→ シングルユーザーのタスク管理では十分。将来的にデータ量が増えた場合は IndexedDB へ移行を検討

**[ブラウザのプライベートモードでデータが消える]**
→ 現時点では許容。将来的にエクスポート機能を検討

**[タブ間の同期がない]**
→ シングルユーザー想定のため当面は許容。必要になれば storage イベントで対応可能
