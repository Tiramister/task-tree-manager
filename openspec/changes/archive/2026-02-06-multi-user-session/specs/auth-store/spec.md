## MODIFIED Requirements

### Requirement: 認証ストアの状態管理
フロントエンドは Zustand ストアで認証状態を管理しなければならない（SHALL）。ストアは現在のアクティブユーザー名（`string | null`）、ローディング状態（`boolean`）、およびログイン済みセッション一覧（`StoredSession[]`）を保持しなければならない（SHALL）。

#### Scenario: 初期状態
- **WHEN** アプリケーションが起動する
- **THEN** ユーザー名は `null`、ローディング状態は `true`、セッション一覧は localStorage から復元される

#### Scenario: 複数セッション保持状態
- **WHEN** 複数ユーザーがログイン済みの状態
- **THEN** セッション一覧にすべてのログイン済みユーザー情報が含まれる

### Requirement: ログインアクション
認証ストアはログインアクションを提供しなければならない（SHALL）。ログインアクションは `POST /login` にユーザー名とパスワードを送信し、成功時に `GET /me` でユーザー名を取得してストアに設定しなければならない（SHALL）。ログイン成功時はセッション情報を localStorage に追加しなければならない（SHALL）。同じユーザーが既にログイン済みの場合は古いセッションを置き換えなければならない（SHALL）。

#### Scenario: ログイン成功
- **WHEN** 正しいユーザー名とパスワードでログインアクションを実行する
- **THEN** `POST /login` が呼び出され、成功後に `GET /me` でユーザー名が取得され、ストアのユーザー名が設定され、セッション情報がlocalStorageに保存される

#### Scenario: ログイン失敗
- **WHEN** 誤ったパスワードでログインアクションを実行する
- **THEN** `POST /login` が 401 を返し、ストアのユーザー名は変更されず、エラーが throw される

#### Scenario: 同一ユーザーの再ログイン
- **WHEN** 既にログイン済みのユーザー名で再度ログインする
- **THEN** 古いセッションが削除され、新しいセッションに置き換わる

### Requirement: ログアウトアクション
認証ストアはログアウトアクションを提供しなければならない（SHALL）。ログアウトアクションは `POST /logout` を呼び出し、当該セッションを localStorage から削除しなければならない（SHALL）。他にセッションがあれば最初のセッションに自動切り替えしなければならない（SHALL）。セッションがなくなれば未ログイン状態に遷移しなければならない（SHALL）。

#### Scenario: ログアウト成功（他セッションあり）
- **WHEN** 複数ユーザーがログイン済みの状態で現在のユーザーをログアウトする
- **THEN** `POST /logout` が呼び出され、当該セッションが削除され、別のセッションに自動切り替えされる

#### Scenario: ログアウト成功（他セッションなし）
- **WHEN** 1ユーザーのみログイン済みの状態でログアウトする
- **THEN** `POST /logout` が呼び出され、ストアのユーザー名が `null` にリセットされ、未ログイン状態になる

### Requirement: 初回ロード時の認証チェック
アプリケーション起動時に localStorage からセッション一覧を復元し、アクティブセッションがあれば `GET /me` を呼び出して認証状態を確認しなければならない（SHALL）。成功時はユーザー名をストアに設定し、失敗時（401）は当該セッションを削除して次のセッションで再試行しなければならない（SHALL）。いずれの場合もローディング状態を `false` に設定しなければならない（SHALL）。

#### Scenario: 有効なセッションが存在する場合の起動
- **WHEN** 有効なセッションが localStorage に存在する状態でアプリケーションが起動する
- **THEN** `GET /me` が成功し、ユーザー名がストアに設定され、ローディング状態が `false` になる

#### Scenario: セッションが存在しない場合の起動
- **WHEN** localStorage にセッションが存在しない状態でアプリケーションが起動する
- **THEN** ユーザー名は `null`、ローディング状態が `false` になる

#### Scenario: アクティブセッション期限切れで他セッションあり
- **WHEN** アクティブセッションが期限切れで、他の有効なセッションがある状態で起動する
- **THEN** 期限切れセッションが削除され、次のセッションで認証が試行される

## ADDED Requirements

### Requirement: ユーザー切り替えアクション
認証ストアはユーザー切り替えアクションを提供しなければならない（SHALL）。切り替えアクションはセッションIDを受け取り、localStorage の `activeSessionId` を更新し、Cookie を書き換え、ストアのユーザー名を更新しなければならない（SHALL）。

#### Scenario: ユーザー切り替え
- **WHEN** 別のログイン済みユーザーのセッションIDで切り替えアクションを実行する
- **THEN** `activeSessionId` が更新され、Cookie が書き換わり、ストアのユーザー名が切り替え先ユーザーに更新される

### Requirement: セッション一覧の取得
認証ストアはログイン済みセッション一覧を取得する機能を提供しなければならない（SHALL）。一覧には各セッションのユーザー名とセッションIDが含まれなければならない（SHALL）。

#### Scenario: セッション一覧の取得
- **WHEN** 複数ユーザーがログイン済みの状態でセッション一覧を取得する
- **THEN** すべてのログイン済みユーザーのユーザー名とセッションIDが返される
