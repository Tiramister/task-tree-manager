## Context

バックエンドには users テーブルと bcrypt ベースの認証機能が実装済みだが、ユーザーを登録する手段が存在しない。運用時にユーザーを追加するには、bcrypt ハッシュ化されたパスワードを含む INSERT 文を手動で構築する必要があるが、これは煩雑でミスが起きやすい。

既存の技術スタック:
- Go 1.25.6（`golang.org/x/crypto/bcrypt` が依存関係に含まれている）
- PostgreSQL 17（users テーブルは UUID 主キー、`gen_random_uuid()` で自動生成）

## Goals / Non-Goals

**Goals:**
- ユーザー名とパスワードを引数で受け取り、users テーブルへの INSERT 文を標準出力に出力する CLI ツールを提供する
- パスワードは bcrypt でハッシュ化し、既存のログイン機能と互換性を持たせる
- 出力された SQL を `psql` 等にパイプして直接実行できるようにする

**Non-Goals:**
- ユーザー登録の API エンドポイントの実装
- ユーザー管理画面（フロントエンド）の実装
- データベースへの直接接続（SQL 出力のみ）

## Decisions

### 1. Go の `cmd/` パターンでスクリプトを実装する

`backend/cmd/adduser/main.go` として実装する。

**理由**: 既存プロジェクトが Go で構成されており、`golang.org/x/crypto/bcrypt` が既に依存関係に含まれている。Go の `cmd/` パターンは複数のエントリポイントを管理する標準的な方法である。

**代替案**:
- シェルスクリプト + `htpasswd`: bcrypt のコスト値を制御しにくく、Go の `bcrypt.DefaultCost` と一致しない可能性がある
- Python スクリプト: 別のランタイムへの依存が生じる

### 2. コマンドライン引数でユーザー名とパスワードを受け取る

`go run ./cmd/adduser <username> <password>` の形式で実行する。

**理由**: 運用時の利便性を優先する。シンプルな引数ベースのインターフェースにより、スクリプトやパイプラインに組み込みやすい。

### 3. SQL 文のみを標準出力に出力する

データベースに直接接続せず、SQL 文をテキストとして出力する。

**理由**: データベースの接続情報をスクリプトに持たせる必要がなくなり、運用者が実行環境や接続先を自由に選択できる。`psql` へのパイプで即座に実行可能。

### 4. bcrypt のコストはデフォルト値を使用する

`bcrypt.DefaultCost`（10）を使用する。

**理由**: 既存の `auth.go` で `bcrypt.GenerateFromPassword` がデフォルトコストで呼ばれているため、一貫性を保つ。

## Risks / Trade-offs

- **パスワードがコマンド履歴に残る** → 運用手順として `history -d` での削除や、環境変数経由での渡し方を README 等で案内する。ただし本変更のスコープ外とする。
- **SQL インジェクションのリスク** → ユーザー名に対してシングルクォートのエスケープ処理を行う。パスワードハッシュは bcrypt 出力のため安全。
