## Context

現在のフロントエンドはローカルストレージ（Zustand persist）でタスクデータを管理しており、バックエンドとの通信は行っていない。バックエンドには `POST /login`、`POST /logout` のエンドポイントとセッションベースの認証ミドルウェアが実装済みだが、ログイン済みユーザーの情報を返すエンドポイントが存在しない。

フロントエンドは React 19 + TypeScript + Vite で構築され、状態管理に Zustand、UIコンポーネントに Radix UI（Dialog, DropdownMenu 等）を使用している。

## Goals / Non-Goals

**Goals:**
- フロントエンドからバックエンドの認証APIを呼び出してログイン・ログアウトできるようにする
- ヘッダー右上にログイン状態（ユーザー名 or ログインボタン）を表示する
- 認証状態をフロントエンドで管理するストアを追加する
- バックエンドに `GET /me` エンドポイントを追加し、認証済みユーザーの情報を返す

**Non-Goals:**
- タスクデータのバックエンドとの同期（別 change で対応）
- ユーザー登録機能（adduser スクリプトで管理）
- パスワード変更・リセット機能
- 未ログイン時のアクセス制御（フロントエンドは未ログインでもローカルデータで利用可能）

## Decisions

### 1. 認証状態管理に Zustand を使用する

**決定**: 既存の taskStore と同様に Zustand で authStore を作成する。

**理由**: プロジェクトで既に Zustand を使用しており、学習コストがない。認証状態は `username | null` とシンプルなので、軽量な Zustand が適している。

**代替案**: React Context — しかしプロジェクト内で Zustand に統一されているため不採用。

### 2. ログインダイアログに Radix UI Dialog を使用する

**決定**: 既にインストール済みの `@radix-ui/react-dialog`（`components/ui/dialog.tsx`）を使用する。

**理由**: アクセシビリティ対応が組み込まれており、プロジェクト内で既に利用可能。

### 3. ヘッダー右上の表示切り替え

**決定**: 未ログイン時は「ログイン」ボタンを表示し、ログイン済み時はユーザー名を表示する。ユーザー名クリックでドロップダウンメニュー（ログアウト）を表示する。

**理由**: ユーザーの要件に沿った設計。Radix UI の DropdownMenu が既に利用可能。

### 4. `GET /me` エンドポイントの追加

**決定**: 認証済みセッションに紐づくユーザー名を返す `GET /me` エンドポイントをバックエンドに追加する。レスポンスは `{ "username": "..." }` の JSON 形式。

**理由**: フロントエンドがページロード時に認証状態を確認するために必要。Cookie ベースのセッションなので、フロントエンドからは直接ユーザー情報を取得できない。

### 5. 初回ロード時の認証チェック

**決定**: アプリ起動時に `GET /me` を呼び出し、成功すればユーザー名をストアに設定、401 なら未ログイン状態とする。

**理由**: Cookie はブラウザが自動送信するため、ページリロード後もセッションが有効なら自動的にログイン状態を復元できる。

### 6. API ベース URL の管理

**決定**: Vite の環境変数 `VITE_API_BASE_URL` で API のベース URL を設定する。デフォルトは空文字（同一オリジン想定）。

**理由**: 開発環境では Vite のプロキシ機能でバックエンドにプロキシし、本番環境ではリバースプロキシで同一オリジンにする想定。環境変数で柔軟に対応できる。

## Risks / Trade-offs

- **リスク: バックエンドが未起動の場合** → `GET /me` が失敗するが、未ログイン状態として扱うだけなので、ローカルデータでの利用は継続できる。
- **リスク: セッション期限切れ** → 24時間でセッション切れ。ログイン状態の定期チェックは今回対象外とし、API呼び出し時に 401 が返ったらログアウト状態にリセットする。
