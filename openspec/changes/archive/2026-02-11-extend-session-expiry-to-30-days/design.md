## Context

現在の実装では、バックエンド `auth.go` の `sessionDuration` が `24 * time.Hour` で定義されており、ログイン時に `expires_at = now + sessionDuration` として保存される。認証時は `expires_at` を参照して期限切れ判定を行うため、セッション有効期間を延長するには主にこの期間定義と関連テスト、仕様記述を整合させる必要がある。

## Goals / Non-Goals

**Goals:**
- セッション有効期限を「作成から 30 日」に統一する。
- `POST /login`、`POST /logout`、`GET /me` など既存 API のインターフェースを変更せずに要件を満たす。
- 仕様（OpenSpec）と実装・テストの有効期限基準を一致させる。

**Non-Goals:**
- スライディングセッション（アクセス時延長）の導入。
- リフレッシュトークン方式への移行。
- 期限切れセッションの定期バッチ削除など、運用改善の追加実装。

## Decisions

1. 有効期限は「固定 30 日（`30 * 24 * time.Hour`）」として扱う。  
理由: 要件の表現が「30 日」であり、カレンダー月（`AddDate(0, 1, 0)`）は月ごとの日数差で挙動が変わるため、テスト可能性と一貫性を優先する。  
代替案: カレンダー月加算（`AddDate`）は実運用感には近いが、2月や月末で境界が複雑になるため不採用。

2. 有効期限値は既存と同様にバックエンド定数で管理し、今回の変更では設定化しない。  
理由: 変更要求は 24 時間から 30 日への固定値変更であり、環境変数化はスコープ外。  
代替案: 環境変数で TTL を可変化する案は将来の要件変動に有効だが、検証・運用ルール追加が必要なため不採用。

3. DB スキーマや API 形状は変更せず、`expires_at` の計算値のみ更新する。  
理由: 既存カラムで要件を満たせ、後方互換性を維持できる。  
代替案: 別カラム追加やセッション種別導入は影響範囲が広く、本変更の目的を超えるため不採用。

## Risks / Trade-offs

- [リスク] セッション寿命が長くなることで、セッション盗難時の悪用可能期間が伸びる  
  → Mitigation: 既存の `HttpOnly`、`SameSite=Lax`、必要時 `Secure` を維持し、ログアウトによる無効化フローを継続する。

- [リスク] 24時間前提の既存テストが失敗する  
  → Mitigation: 期限境界のテストデータと期待値を 30 日基準に更新し、境界条件（30日以内/超過）を明示的に検証する。

- [トレードオフ] デプロイ前に発行済みのセッションは既存 `expires_at` に従い 24 時間で失効する  
  → Mitigation: 互換性上問題はなく、データ移行なしで安全に段階適用できることを優先する。

## Migration Plan

1. バックエンドのセッション期間定数を 30 日へ変更する。
2. セッション有効期限のテストケースを 30 日基準へ更新する。
3. OpenSpec の `user-auth` 要件差分を更新し、仕様と実装を一致させる。
4. リリース後は新規ログインセッションから 30 日有効が適用されることを確認する。

ロールバックは定数値を 24 時間に戻して再デプロイする。DB マイグレーションは不要。

## Open Questions

- セッション有効期限を将来的に設定値化するか（現時点では要件外）。
